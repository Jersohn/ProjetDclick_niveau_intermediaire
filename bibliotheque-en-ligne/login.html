<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Connexion - Bibliothèque en ligne</title>
		<link rel="stylesheet" href="css/style.css" />
	</head>
	<body>
		<header>
			<h1>Bibliothèque en ligne</h1>
			<nav>
				<ul>
					<li><a href="index.html">Accueil</a></li>
					<li><a href="wishlist.html">Ma liste de lecture</a></li>
					<li><a href="login.html">Connexion</a></li>
					<li><a href="register.html">Inscription</a></li>
				</ul>
			</nav>
		</header>

		<main>
			<div class="auth-form">
				<h2>Connexion</h2>
				<form id="login-form">
					<div class="form-group">
						<label for="email">Email:</label>
						<input type="email" id="email" name="email" required />
					</div>

					<div class="form-group">
						<label for="password">Mot de passe:</label>
						<input type="password" id="password" name="password" required />
					</div>

					<button type="submit" class="btn">Se connecter</button>
				</form>

				<p>
					Pas encore de compte? <a href="register.html">Inscrivez-vous ici</a>
				</p>

				<div id="login-message" style="margin-top: 20px"></div>
			</div>
		</main>

		<footer>
			<p>&copy; 2023 Bibliothèque en ligne. Tous droits réservés.</p>
		</footer>

		<script src="js/script.js"></script>
		<script>
			document
				.getElementById("login-form")
				.addEventListener("submit", function (e) {
					e.preventDefault();

					const email = document.getElementById("email").value;
					const password = document.getElementById("password").value;

					// Envoyer les données de connexion au serveur
					fetch("php/login.php", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							email: email,
							password: password,
						}),
					})
						.then((response) => response.json())
						.then((data) => {
							const messageElement = document.getElementById("login-message");
							if (data.success) {
								messageElement.innerHTML =
									'<p style="color: green;">Connexion réussie! Redirection...</p>';
								// Stocker l'ID de l'utilisateur
								localStorage.setItem("user_id", data.user_id);
								// Rediriger vers la page d'accueil après 1 seconde
								setTimeout(() => {
									window.location.href = "index.html";
								}, 1000);
							} else {
								messageElement.innerHTML = `<p style="color: red;">Erreur: ${data.message}</p>`;
							}
						})
						.catch((error) => {
							console.error("Erreur:", error);
							document.getElementById("login-message").innerHTML =
								'<p style="color: red;">Erreur de connexion au serveur</p>';
						});
				});
		</script>
	</body>
</html>
